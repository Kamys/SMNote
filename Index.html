<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SMNote</title>
</head>

<body>
<div>
    <div id="workspace">
    </div>
</div>
<link rel="stylesheet" href="./common.blocks/workspace/workspace.css">
<link rel="stylesheet" href="./common.blocks/workspace/workspace__v-object.css">
<link rel="stylesheet" href="./common.blocks/workspace/workspace__v-text.css">
<link rel="stylesheet" href="./bower_components/jquery-ui/themes/base/all.css">
<script src="./bower_components/jquery/dist/jquery.min.js"></script>
<script src="./bower_components/jquery-ui/jquery-ui.js"></script>
<script>

    let idCount;

    function generateId() {
        idCount++;
        return idCount;
    }

    function VObject() {
        /**
         * @type {jQuery}
         */
        let element;
        init();

        function init() {
            element = $(`<div id="Object${generateId()}" class="workspace__vobject"></div>`);
            let workspace = $('#workspace');
            element.draggable({
                containment: workspace,
                start: focused,
                stop: focused
            });
            element.resizable({
                autoHide: false,
                containment: workspace,
                start: focused,
                stop: focused
            });
            workspace.append(element);
        }

        function focused() {
            $(this).toggleClass('v-object_focused');
        }

        this.getElement = function () {
            return element;
        }
    }

    function VText(text) {
        let element;
        init();

        function init() {
            element = $(`<p class="workspace__v-text workspace__v-text_noselect">${text}</p>`);
            let vObject = new VObject();
            let textArea;
            vObject.getElement().dblclick(function () {
                if (textArea) {
                    return;
                }
                textArea = $(`<textarea class="workspace__v-text_noresize"></textarea>`);
                textArea.val(element.text());
                element.hide();
                element.after(textArea);

                textArea.focus();
                textArea.on("blur", function () {
                    if (!textArea) {
                        return;
                    }
                    console.log('on');
                    element.text(textArea.val());
                    element.show();
                    textArea.remove();
                    textArea = null;
                });
            });

            vObject.getElement().append(element)
        }
    }

    window.addEventListener('paste', function (event) {
        event.preventDefault();
        const data = event.clipboardData.getData('text');
        console.log(data);
        new VText(data);
    });
</script>
</body>

</html>