<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SMNote</title>
</head>

<body>
<div>
    <div id="workspace">
    </div>
</div>
<style type="text/css">

    #workspace {
        width: 100%;
        height: 100%;
        position: absolute;
    }

    .vobject {
        width: 100px;
        height: 100px;
        position: absolute !important;
    }

    .vobject_focused{
        border: 1px solid grey;
    }

    .square-text {
        word-wrap: break-word;
        width: 100%;

    }

    .noselect {
        -webkit-touch-callout: none;
        /* iOS Safari */
        -webkit-user-select: none;
        /* Safari */
        -khtml-user-select: none;
        /* Konqueror HTML */
        -moz-user-select: none;
        /* Firefox */
        -ms-user-select: none;
        /* Internet Explorer/Edge */
        user-select: none;
        /* Non-prefixed version, currentlys
                              supported by Chrome and Opera */
    }

    /*noinspection CssUnusedSymbol*/
    .ui-resizable-se {
        /* Need for comforts resizable ^_^ */
        width: 20px !important;
        height: 20px !important;
    }

    textarea {
        resize: none;
        word-wrap: break-word;
        width: 100%;
        height: 100%;
    }
</style>
<link rel="stylesheet" href="./bower_components/jquery-ui/themes/base/all.css">
<script src="./bower_components/jquery/dist/jquery.min.js"></script>
<script src="./bower_components/jquery-ui/jquery-ui.js"></script>
<script>

    let idCount;

    function generateId() {
        idCount++;
        return idCount;
    }

    function VObject() {
        /**
         * @type {jQuery}
         * @
         */
        let element;
        init();

        function init() {
            element = $(`<div id="Object${generateId()}" class="vobject"></div>`);
            let workspace = $('#workspace');
            element.draggable({
                containment: workspace,
                start: focused,
                stop: focused
            });
            element.resizable({
                autoHide: false, containment: workspace
            });
            workspace.append(element);
        }

        function focused() {
            $(this).toggleClass('vobject_focused');
        }

        this.getElement = function () {
            return element;
        }
    }

    function VText(text) {
        let element;
        init();

        function init() {
            element = $(`<p class="noselect square-text">${text}</p>`);
            let vObject = new VObject();
            let textArea;
            vObject.getElement().dblclick(function () {
                if(textArea){
                    return;
                }
                textArea = $(`<textarea></textarea>`);
                textArea.val(element.text());
                element.hide();
                element.after(textArea);

                textArea.focus();
                textArea.on("blur", function () {
                    if(!textArea){
                        return;
                    }
                    console.log('on');
                    element.text(textArea.val());
                    element.show();
                    textArea.remove();
                    textArea = null;
                });
            });

            vObject.getElement().append(element)
        }
    }

    window.addEventListener('paste', function (event) {
        event.preventDefault();
        const data = event.clipboardData.getData('text');
        console.log(data);
        new VText(data);
    });
</script>
</body>

</html>